<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EnPick - í…ŒìŠ¤íŠ¸ ì‹œì‘</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .setup-wrapper {
      margin-left: 220px;
      padding: 40px;
      padding-top: 80px;
    }

    .setup-container {
      max-width: 600px;
      margin: auto;
      background: #f9f9ff;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 24px;
    }

    .group-label {
      margin-top: 24px;
      font-weight: bold;
      position: relative;
    }

    .option-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }

    .option-row label {
      display: inline-block;
      padding: 10px 16px;
      background-color: #e0e7ff;
      border-radius: 8px;
      cursor: pointer;
    }

    .option-row input:checked + label {
      background-color: #6c80ff;
      color: white;
    }

    .start-btn {
      margin-top: 32px;
      width: 100%;
      padding: 14px;
      background-color: #6c80ff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .info-icon {
      margin-left: 8px;
      color: #888;
      cursor: pointer;
      font-size: 15px;
      position: relative;
    }

    .info-tooltip {
      display: none;
      position: absolute;
      background-color: #fff;
      border: 1px solid #aaa;
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      color: #333;
      white-space: normal;
      z-index: 999;
      max-width: 300px;
      top: 28px;
      left: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    @media (max-width: 768px) {
      .setup-wrapper {
        margin-left: 0;
        padding-top: 80px;
      }
    }

  </style>
</head>
<body>
  <nav class="nav-bar">
    <div class="nav-logo">
      <img src="assets/enpick-logo.png" alt="EnPick ë¡œê³ " />
      <h2>EnPick</h2>
    </div>
    <div class="nav-user">
      <a href="#" id="logoutBtn" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
    <div class="hamburger" id="hamburger">&#9776;</div>
  </nav>

  <div class="sidebar" id="sidebar">
    <a href="home.html" class="menu-item">í™ˆ</a>
    <a href="vocabulary.html" class="menu-item">ì „ì²´ ë‹¨ì–´ì¥</a>
    <a href="mywords.html" class="menu-item">My ë‹¨ì–´ì¥</a>
    <a href="study.html" class="menu-item">í•™ìŠµ</a>
    <a href="gamestart.html" class="menu-item">ë‹¨ì–´ ë¯¸ë‹ˆ ê²Œì„</a>
    <a href="teststart.html" class="menu-item active">í…ŒìŠ¤íŠ¸</a>
    <a href="#" class="menu-item">í†µê³„</a>
  </div>

  <div class="setup-wrapper">
    <div class="setup-container">
      <h1>ğŸ“ í…ŒìŠ¤íŠ¸ ì‹œì‘</h1>

      <div class="group-label">í…ŒìŠ¤íŠ¸ ìœ í˜•
        <i class="fa-solid fa-circle-info info-icon" tabindex="0"></i>
        <div class="info-tooltip">
          ë ˆë²¨ í…ŒìŠ¤íŠ¸ëŠ” ê° ë‚œì´ë„ë³„ 6ë¬¸ì œì”© ì¶”ì²œë˜ë©°,<br>
          í…ŒìŠ¤íŠ¸ í›„ ì¶”ì²œ í•™ìŠµ ë‚œì´ë„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.<br><br>
          ë¯¸ì…˜ ë‹¨ì–´ í…ŒìŠ¤íŠ¸ëŠ” í™ˆ í™”ë©´ ë¯¸ì…˜ì—ì„œë§Œ<br>
          ì ‘ê·¼í•˜ì—¬ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
      <div class="option-row">
        <input type="radio" name="testType" value="daily" id="daily" checked hidden />
        <label for="daily">ë§¤ì¼ í…ŒìŠ¤íŠ¸</label>

        <input type="radio" name="testType" value="level" id="level" hidden />
        <label for="level">ë ˆë²¨ í…ŒìŠ¤íŠ¸</label>
      </div>

      <div class="group-label" id="sourceLabel">ë‹¨ì–´ì¥ ì„ íƒ (ë§¤ì¼ í…ŒìŠ¤íŠ¸ ì „ìš©)</div>
      <div class="option-row" id="sourceGroup">
        <input type="radio" name="source" value="mywords" id="mywords" checked hidden />
        <label for="mywords">My ë‹¨ì–´ì¥</label>

        <input type="radio" name="source" value="all" id="all" hidden />
        <label for="all">ì „ì²´ ë‹¨ì–´ì¥</label>
      </div>

      <div class="group-label" id="difficultyLabel">ë‚œì´ë„ ì„ íƒ (ì¤‘ë³µ ê°€ëŠ¥)</div>
      <div class="option-row" id="difficultyGroup">
        <input type="checkbox" name="difficulty" value="600" id="d600" checked hidden />
        <label for="d600">600</label>

        <input type="checkbox" name="difficulty" value="700" id="d700" checked hidden />
        <label for="d700">700</label>

        <input type="checkbox" name="difficulty" value="800" id="d800" checked hidden />
        <label for="d800">800</label>

        <input type="checkbox" name="difficulty" value="900" id="d900" checked hidden />
        <label for="d900">900</label>
      </div>

      <div class="group-label" id="learnedLabel" style="display: none;">í•™ìŠµ ìƒíƒœ ì„ íƒ (Myë‹¨ì–´ì¥ ì „ìš©)</div>
      <div class="option-row" id="learnedGroup" style="display: none;">
        <input type="checkbox" name="learned" value="unlearned" id="unlearned" checked hidden />
        <label for="unlearned">ë¯¸í•™ìŠµ</label>

        <input type="checkbox" name="learned" value="learned" id="learned" checked hidden />
        <label for="learned">í•™ìŠµì™„ë£Œ</label>
      </div>

      <div class="group-label" id="countLabel">ë¬¸ì œ ìˆ˜</div>
      <div class="option-row" id="countGroup">
        <input type="radio" name="count" value="10" id="c10" checked hidden />
        <label for="c10">10ë¬¸ì œ</label>

        <input type="radio" name="count" value="20" id="c20" hidden />
        <label for="c20">20ë¬¸ì œ</label>

        <input type="radio" name="count" value="30" id="c30" hidden />
        <label for="c30">30ë¬¸ì œ</label>
      </div>

      <button class="start-btn" onclick="startTest()">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    </div>
  </div>

  <script>
    document.getElementById("hamburger")?.addEventListener("click", () => {
      document.getElementById("sidebar")?.classList.toggle("show");
    });

    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const res = await fetch('/api/me', { credentials: 'include' });
        if (!res.ok) throw new Error();
        const user = await res.json();

        const userSpan = document.createElement('span');
        userSpan.textContent = `${user.email}ë‹˜`;
        document.querySelector('.nav-user')?.prepend(userSpan);

        document.getElementById('logoutBtn')?.addEventListener('click', async () => {
          try {
            await fetch('/logout', {
              method: 'POST',
              credentials: 'include'
            });
          } catch (err) {
            console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', err);
          }

          localStorage.clear();
          window.location.href = 'login.html';
        });
      } catch (err) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = 'login.html';
      }
    });


    const testTypeRadios = document.querySelectorAll('input[name="testType"]');
    const sourceGroup = document.getElementById("sourceGroup");
    const sourceLabel = document.getElementById("sourceLabel");
    const difficultyGroup = document.getElementById("difficultyGroup");
    const difficultyLabel = document.getElementById("difficultyLabel");
    const countGroup = document.getElementById("countGroup");
    const countLabel = document.getElementById("countLabel");
    const learnedGroup = document.getElementById("learnedGroup");
    const learnedLabel = document.getElementById("learnedLabel");

    function toggleGroups() {
      const isDaily = document.getElementById("daily").checked;
      const isLevel = document.getElementById("level").checked;
      const isAll = document.getElementById("all").checked;
      const isMyWords = document.getElementById("mywords").checked;

      sourceGroup.style.display = sourceLabel.style.display = isDaily ? "flex" : "none";
      difficultyGroup.style.display = difficultyLabel.style.display = (isDaily && isAll) ? "flex" : "none";
      countGroup.style.display = countLabel.style.display = isLevel ? "none" : "flex";
      learnedGroup.style.display = learnedLabel.style.display = (isDaily && isMyWords) ? "flex" : "none";
    }

    testTypeRadios.forEach(radio => radio.addEventListener("change", toggleGroups));
    document.querySelectorAll('input[name="source"]').forEach(r => r.addEventListener("change", toggleGroups));
    toggleGroups();

    function startTest() {
      const testType = document.querySelector('input[name="testType"]:checked').value;
      const source = document.querySelector('input[name="source"]:checked')?.value || '';
      const difficulties = Array.from(document.querySelectorAll('input[name="difficulty"]:checked')).map(cb => cb.value);
      const learned = Array.from(document.querySelectorAll('input[name="learned"]:checked')).map(cb => cb.value);

      const params = new URLSearchParams();
      params.set("type", testType);
      params.set("count", testType === "level" ? "24" : document.querySelector('input[name="count"]:checked').value);
      if (testType === 'daily') {
        params.set("source", source);
        if (source === 'all') {
          params.set("difficulty", difficulties.join(","));
        } else if (source === 'mywords') {
          params.set("learned", learned.join(","));
        }
      }

      window.location.href = `test.html?${params.toString()}`;
    }

    document.addEventListener('click', (e) => {
      document.querySelectorAll('.info-tooltip').forEach(t => t.style.display = 'none');

      if (e.target.classList.contains('info-icon')) {
        const tooltip = e.target.nextElementSibling;
        if (tooltip) {
          tooltip.style.display = 'block';
        }
      }
    });

    document.addEventListener('mouseover', (e) => {
      if (e.target.classList.contains('info-icon')) {
        const tooltip = e.target.nextElementSibling;
        if (tooltip) tooltip.style.display = 'block';
      }
    });

    document.addEventListener('mouseout', (e) => {
      if (e.target.classList.contains('info-icon')) {
        const tooltip = e.target.nextElementSibling;
        if (tooltip) tooltip.style.display = 'none';
      }
    });

  </script>
</body>
</html>

